{% extends "base.html" %}

{% block content %}
<div class="row mb-4">
    <div class="col">
        <h1>Inventory Management</h1>
    </div>
    <div class="col-auto">
        <a href="{{ url_for('inventory.add_medication') }}" class="btn btn-success">
            <i class="bi bi-plus-circle"></i> Add Medication
        </a>
    </div>
</div>

<div class="card mb-4">
    <div class="card-header">
        <h5 class="card-title">Filters</h5>
    </div>
    <div class="card-body">
        <div class="btn-group" role="group">
            <a href="{{ url_for('inventory.inventory', filter='all') }}" class="btn btn-outline-primary {% if filter_type == 'all' %}active{% endif %}">
                All Medications
            </a>
            <a href="{{ url_for('inventory.inventory', filter='low_stock') }}" class="btn btn-outline-warning {% if filter_type == 'low_stock' %}active{% endif %}">
                Low Stock
            </a>
            <a href="{{ url_for('inventory.inventory', filter='expired') }}" class="btn btn-outline-danger {% if filter_type == 'expired' %}active{% endif %}">
                Expired
            </a>
            <a href="{{ url_for('inventory.inventory', filter='expiring_soon') }}" class="btn btn-outline-info {% if filter_type == 'expiring_soon' %}active{% endif %}">
                Expiring Soon
            </a>
        </div>
    </div>
</div>

<div class="card">
    <div class="card-body">
        <div class="table-responsive">
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Name</th>
                        <th>Generic</th>
                        <th>Manufacturer</th>
                        <th>Price</th>
                        <th>Stock</th>
                        <th>Category</th>
                        <th>Expiry Date</th>
                        <th>Status</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for med in medications %}
                    <tr class="{% if med.expiry_date and med.expiry_date < now %}table-danger{% elif med.stock_quantity <= 5 %}table-warning{% endif %}">
                        <td>{{ med.id }}</td>
                        <td>{{ med.name }}</td>
                        <td>{{ med.generic_name or 'N/A' }}</td>
                        <td>{{ med.manufacturer or 'N/A' }}</td>
                        <td>${{ "%.2f"|format(med.price) }}</td>
                        <td>
                            {{ med.stock_quantity }}
                            {% if med.stock_quantity <= 5 %}
                            <span class="badge bg-warning ms-1">Low</span>
                            {% endif %}
                        </td>
                        <td>{{ med.category or 'N/A' }}</td>
                        <td>
                            {% if med.expiry_date %}
                                {{ med.expiry_date.strftime('%Y-%m-%d') }}
                            {% else %}
                                N/A
                            {% endif %}
                        </td>
                        <td>
                            {% if med.expiry_date %}
                                {% if med.expiry_date < now %}
                                    <span class="badge bg-danger">Expired</span>
                                {% elif (med.expiry_date - now).days <= 30 %}
                                    <span class="badge bg-warning">Expiring Soon</span>
                                {% else %}
                                    <span class="badge bg-success">OK</span>
                                {% endif %}
                            {% else %}
                                <span class="badge bg-secondary">No Expiry</span>
                            {% endif %}
                        </td>
                        <td>
                            <div class="btn-group btn-group-sm">
                                <a href="{{ url_for('inventory.edit_medication', id=med.id) }}" class="btn btn-primary" title="Edit">
                                    <i class="bi bi-pencil"></i>
                                </a>
                                <a href="{{ url_for('inventory.delete_medication', id=med.id) }}" class="btn btn-danger" title="Delete" onclick="return confirm('Are you sure you want to delete this medication?')">
                                    <i class="bi bi-trash"></i>
                                </a>
                            </div>
                        </td>
                    </tr>
                    {% else %}
                    <tr>
                        <td colspan="10" class="text-center py-4">
                            <div class="text-muted">
                                <i class="bi bi-inbox" style="font-size: 2rem;"></i>
                                <p class="mt-2">No medications found</p>
                                {% if filter_type != 'all' %}
                                <a href="{{ url_for('inventory.inventory', filter='all') }}" class="btn btn-primary btn-sm mt-2">
                                    View All Medications
                                </a>
                                {% endif %}
                            </div>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<style>
.table-danger {
    background-color: #f8d7da !important;
}
.table-warning {
    background-color: #fff3cd !important;
}
</style>
{% endblock %}