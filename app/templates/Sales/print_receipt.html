<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Receipt - {{ sale.transaction_id }}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.1/font/bootstrap-icons.css">
    <style>
        @media print {
            body { margin: 0; padding: 0; }
            .no-print { display: none !important; }
            .container { max-width: 100% !important; padding: 0 !important; }
            .card { border: none !important; box-shadow: none !important; }
            .btn { display: none !important; }
        }
        body { font-family: 'Courier New', monospace; }
        .receipt { width: 80mm; margin: 0 auto; }
        .text-center { text-align: center; }
        .text-end { text-align: right; }
        .table-sm th, .table-sm td { padding: 0.25rem; }
        .border-top { border-top: 1px dashed #ccc !important; }
    </style>
</head>
<body>
    <div class="container mt-4">
        <div class="row justify-content-center">
            <div class="col-12">
                <!-- Print Controls -->
                <div class="text-center mb-3 no-print">
                    <button onclick="window.print()" class="btn btn-primary">
                        <i class="bi bi-printer"></i> Print Receipt
                    </button>
                    <button onclick="window.close()" class="btn btn-secondary">
                        <i class="bi bi-x-circle"></i> Close
                    </button>
                </div>

                <!-- Receipt Content -->
                <div class="card receipt">
                    <div class="card-body">
                        <!-- Header -->
                        <div class="text-center mb-3">
                            <h5 class="mb-1"><strong>ကောင်းလာဘ်စံ</strong></h5>
                            <p class="mb-1" style="font-size: 0.9rem;">Pharmacy & Medical Supplies</p>
                            <p class="mb-1" style="font-size: 0.8rem;">Quality Healthcare Products</p>
                            <p class="mb-2" style="font-size: 0.8rem;">Tel: +959 123 456 789</p>
                        </div>

                        <!-- Transaction Info -->
                        <div class="mb-2">
                            <div class="d-flex justify-content-between">
                                <span>Receipt:</span>
                                <span><strong>{{ sale.transaction_id }}</strong></span>
                            </div>
                            <div class="d-flex justify-content-between">
                                <span>Date:</span>
                                <span>{{ sale.sale_date.strftime('%Y-%m-%d %H:%M') }}</span>
                            </div>
                            <div class="d-flex justify-content-between">
                                <span>Cashier:</span>
                                <span>{{ sale.user.username }}</span>
                            </div>
                        </div>

                        <!-- Customer Info -->
                        {% if sale.customer %}
                        <div class="border-top pt-2 mb-2">
                            <div class="d-flex justify-content-between">
                                <span>Customer:</span>
                                <span>{{ sale.customer.name }}</span>
                            </div>
                            {% if sale.customer.phone %}
                            <div class="d-flex justify-content-between">
                                <span>Phone:</span>
                                <span>{{ sale.customer.phone }}</span>
                            </div>
                            {% endif %}
                        </div>
                        {% endif %}

                        <!-- Items -->
                        <div class="border-top pt-2 mb-2">
                            <table class="table table-sm mb-2">
                                <thead>
                                    <tr>
                                        <th>Item</th>
                                        <th class="text-end">Qty</th>
                                        <th class="text-end">Total</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for item in sale.items %}
                                    <tr>
                                        <td>{{ item.medication.name }}</td>
                                        <td class="text-end">{{ item.quantity }} × ${{ "%.2f"|format(item.unit_price) }}</td>
                                        <td class="text-end">${{ "%.2f"|format(item.total_price) }}</td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>

                        <!-- Totals -->
                        <div class="border-top pt-2">
                            <div class="d-flex justify-content-between">
                                <span>Subtotal:</span>
                                <span>${{ "%.2f"|format(sale.total_amount + sale.discount_amount - sale.tax_amount) }}</span>
                            </div>
                            {% if sale.tax_amount > 0 %}
                            <div class="d-flex justify-content-between">
                                <span>Tax:</span>
                                <span>${{ "%.2f"|format(sale.tax_amount) }}</span>
                            </div>
                            {% endif %}
                            {% if sale.discount_amount > 0 %}
                            <div class="d-flex justify-content-between text-success">
                                <span>Discount:</span>
                                <span>-${{ "%.2f"|format(sale.discount_amount) }}</span>
                            </div>
                            {% endif %}
                            <div class="d-flex justify-content-between border-top pt-1">
                                <strong>TOTAL:</strong>
                                <strong>${{ "%.2f"|format(sale.total_amount) }}</strong>
                            </div>
                            <div class="d-flex justify-content-between">
                                <span>Payment:</span>
                                <span>{{ sale.payment_method|title }}</span>
                            </div>
                        </div>

                        <!-- Footer -->
                        <div class="border-top pt-2 text-center mt-3">
                            <p class="mb-1" style="font-size: 0.8rem;">Thank you for your purchase!</p>
                            <p class="mb-1" style="font-size: 0.7rem;">Returns within 7 days with receipt</p>
                            <p class="mb-0" style="font-size: 0.7rem;">www.kaunglarbhan.com</p>
                        </div>

                        <!-- Barcode Space -->
                        <div class="text-center mt-3">
                            <div style="height: 40px; border: 1px dashed #ccc; display: flex; align-items: center; justify-content: center;">
                                <small class="text-muted">Barcode: {{ sale.transaction_id }}</small>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Print Message -->
                <div class="text-center mt-3 no-print">
                    <p class="text-muted">This receipt is ready for printing. Click the print button above.</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Auto-print when page loads
        window.onload = function() {
            window.print();
        };
        
        // Close window after print
        window.onafterprint = function() {
            setTimeout(function() {
                window.close();
            }, 1000);
        };
    </script>
</body>
</html>